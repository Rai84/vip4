<div id="checkoutModal" class="fixed inset-0 z-50 flex items-center justify-center hidden bg-black bg-opacity-60">
  <div class="relative w-full max-w-xl p-8 font-sans text-gray-900 bg-white shadow-xl rounded-2xl">
    <h3 class="mb-6 text-3xl font-extrabold tracking-tight text-center text-black">Finalizar Pedido</h3>

    <!-- Etapa 1: Endereço e Forma de Pagamento -->
    <div id="etapa1" class="space-y-8">
      <!-- Endereço de entrega -->
      <div>
        <h4 class="mb-2 text-lg font-semibold text-gray-700">Endereço de Entrega</h4>
        <select id="enderecoSelect" class="w-full px-4 py-3 transition border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          <option value="" disabled selected>Selecione um endereço</option>
          <option th:each="end : ${enderecos}" th:value="${end.id}"
                  th:text="${end.logradouro + ', ' + end.numero + ' - ' + end.cidade}"></option>
        </select>
        <button onclick="abrirModalFormEnderecoEntrega()" 
                class="inline-block px-5 py-2 mt-3 text-white transition bg-indigo-600 rounded-md shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
          + Novo Endereço
        </button>
      </div>

      <!-- Forma de pagamento -->
      <div>
        <h4 class="mb-2 text-lg font-semibold text-gray-700">Forma de Pagamento</h4>
        <select id="pagamentoSelect" onchange="mostrarCamposCartao(this.value)"
                class="w-full px-4 py-3 transition border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          <option value="" disabled selected>Selecione uma forma de pagamento</option>
          <option value="BOLETO">Boleto</option>
          <option value="CARTAO">Cartão de Crédito</option>
        </select>
      </div>

      <!-- Campos de cartão -->
      <div id="cartaoCampos" class="hidden mt-4 space-y-4">
        <input type="text" id="numeroCartao" placeholder="Número do Cartão" 
               class="w-full px-4 py-3 transition border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
        <input type="text" id="nomeCartao" placeholder="Nome Completo" 
               class="w-full px-4 py-3 transition border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
        <div class="flex space-x-4">
          <input type="text" id="codigoSeguranca" placeholder="Código de Segurança" maxlength="4" 
                 class="flex-1 px-4 py-3 transition border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
          <input type="text" id="dataValidade" placeholder="Validade (MM/AA)" maxlength="5"
                 class="flex-1 px-4 py-3 transition border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
          <input type="number" id="parcelas" placeholder="Parcelas" min="1" max="12" 
                 class="flex-1 px-4 py-3 transition border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
        </div>
      </div>

      <!-- Botões -->
      <div class="flex justify-between mt-8">
        <button class="px-6 py-3 text-gray-700 transition bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400"
                onclick="fecharCheckoutModal()">Cancelar</button>
        <button class="px-6 py-3 text-white transition bg-indigo-600 rounded-md shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                onclick="irParaResumo()">Próximo</button>
      </div>
    </div>

    <!-- Etapa 2: Resumo -->
    <div id="etapa2" class="hidden space-y-6">
      <div>
        <h4 class="mb-4 text-xl font-semibold text-gray-700">Resumo do Pedido</h4>
        <p th:text="'Produtos: R$ ' + ${subtotal}" class="mb-2 font-medium">Produtos: R$ 0,00</p>
        <div class="mb-3">
          <p class="mb-1 font-semibold">Itens:</p>
          <ul class="space-y-1 text-gray-800 list-disc list-inside">
            <li th:each="item : ${itens}" th:text="${item.produto.nomeProduto} + ' - Quantidade: ' + ${item.quantidade}">
              Produto - Quantidade: X
            </li>
          </ul>
        </div>
        <p th:text="'Frete: R$ ' + ${frete}" class="mb-2 font-medium">Frete: R$ 0,00</p>
        <p class="mb-4 text-lg font-bold" th:text="'Total: R$ ' + ${total}">Total: R$ 0,00</p>
        <p><strong>Endereço:</strong> <span id="resumoEndereco" class="text-gray-700">Não informado</span></p>
        <p><strong>Forma de Pagamento:</strong> <span id="resumoPagamento" class="text-gray-700">Não informado</span></p>
      </div>

      <div class="flex justify-between mt-6">
        <button class="px-6 py-3 text-gray-700 transition bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400"
                onclick="voltarParaEtapa1()">Voltar</button>
        <button class="px-6 py-3 text-white transition bg-indigo-600 rounded-md shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                onclick="confirmarPedido()">Confirmar Pedido</button>
      </div>
    </div>

    <!-- Botão de fechar -->
    <button class="absolute text-2xl font-extrabold text-gray-400 transition top-4 right-4 hover:text-red-600 focus:outline-none"
            onclick="fecharCheckoutModal()" aria-label="Fechar modal">&times;</button>
  </div>
</div>
